<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Bowl Prop Matrix</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #f4f6f9; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; /* Prevent double scrollbars */ }
        
        /* Hero Section */
        .header-container { 
            background: linear-gradient(90deg, #C60C30 0%, #002244 40%, #002244 60%, #69BE28 100%);
            color: white; 
            padding: 15px 20px; 
            text-align: center; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            height: 140px; /* Fixed height for header area */
        }
        
        /* SCROLLABLE TABLE CONTAINER (The Magic Window) */
        .table-container {
            height: calc(100vh - 160px); /* Fill the rest of the screen */
            overflow: auto; /* Enable Scrollbars */
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-top: -20px;
            position: relative;
            margin-left: 10px;
            margin-right: 10px;
        }

        table { white-space: nowrap; font-size: 0.9rem; border-collapse: separate; border-spacing: 0; }
        
        /* --- STICKY HEADER LOGIC (Top Freeze) --- */
        thead {
            position: sticky;
            top: 0;
            z-index: 10; /* sits above the body data */
        }

        /* --- STICKY COLUMN LOGIC (Left Freeze) --- */
        .sticky-col {
            position: sticky;
            z-index: 5; /* sits above normal data */
            border-right: 2px solid #dee2e6;
        }
        
        /* The "Super Sticky" Corners (Top Left) need highest Z-Index */
        thead .sticky-col {
            z-index: 20 !important; /* Highest priority: Sits on top of everything */
        }

        .col-rank { left: 0; min-width: 40px; text-align: center; background-color: #f8f9fa; }
        .col-name { left: 40px; min-width: 150px; text-align: left !important; padding-left: 15px; background-color: #fff; }
        .col-score { left: 190px; min-width: 80px; font-weight: bold; text-align: center; background-color: #fff; }

        /* Color Coding */
        .correct-cell { background-color: #d1e7dd !important; color: #0f5132; border: 1px solid #badbcc; } 
        .incorrect-cell { background-color: #f8d7da !important; color: #842029; border: 1px solid #f5c2c7; }
        
        /* Answer Key Styling */
        .key-row td, .key-row th { 
            background-color: #212529 !important; 
            color: #ffc107 !important; 
            font-weight: bold;
            border-bottom: 2px solid #ffd700;
        }

        /* Header Text Alignment */
        thead th { vertical-align: bottom !important; text-align: center; background-color: #212529; color: white; }
        tbody td { text-align: center; vertical-align: middle; }
        .table-warning { background-color: #fff3cd !important; }
        .loading-msg { padding: 40px; text-align: center; font-style: italic; color: #666; }
    </style>
</head>
<body>

    <div class="header-container">
        <h2 class="m-0"><i class="fas fa-football-ball"></i> 11th Annual Prop Bet Challenge Tracker</h2>
        <div class="d-flex justify-content-center gap-2 mt-3">
            <button onclick="loadData()" class="btn btn-warning btn-sm fw-bold shadow-sm">
                <i class="fas fa-sync-alt"></i> Refresh
            </button>
            <input type="text" id="searchInput" onkeyup="filterTable()" 
                   class="form-control form-control-sm shadow-sm" 
                   style="max-width: 200px;" placeholder="ðŸ” Find my name...">
        </div>
    </div>

    <div class="table-container">
        <table class="table table-hover mb-0" id="prop-table">
            </table>
        <div id="loading" class="loading-msg">Loading data from the field...</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    
    <script>
        // --- PASTE YOUR WEB_MATRIX CSV LINK HERE ---
        const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQnJhX-sCrEbK84FJi1MOIV7v-PDjYDBw5c8Adpqugt9zb4H1PGW42ziWcQhAi1jA/pub?gid=1689955040&single=true&output=csv"; 

        function loadData() {
            const loading = document.getElementById("loading");
            const table = document.getElementById("prop-table");
            
            loading.style.display = "block";
            table.innerHTML = "";

            Papa.parse(sheetUrl, {
                download: true, header: false,
                complete: function(results) { renderTable(results.data); },
                error: function(err) { loading.innerText = "Error loading data."; }
            });
        }

        function renderTable(data) {
            const table = document.getElementById("prop-table");
            let html = "";
            
            if (!data || data.length < 2) return;

            const headers = data[0];
            const keyRow = data[1]; 
            const players = data.slice(2); 

            // 1. CALCULATE CROWD STATS
            let stats = [];
            headers.forEach((h, colIndex) => {
                if(colIndex < 2 || !h) { stats.push(null); return; }
                const correctAns = keyRow[colIndex];
                if(!correctAns || correctAns === "") { stats.push(null); return; }

                let correctCount = 0; let totalCount = 0;
                players.forEach(player => {
                    if(player[0]) {
                        totalCount++;
                        if(player[colIndex] === correctAns) correctCount++;
                    }
                });
                let percent = totalCount > 0 ? Math.round((correctCount / totalCount) * 100) : 0;
                stats.push(percent + "% Correct");
            });

            // --- START BUILDING THEAD (Now includes Headers AND Key Row) ---
            html += `<thead>`;
            
            // ROW 1: HEADERS
            html += `<tr>`;
            headers.forEach((h, index) => {
                let stickyClass = "";
                if(index === 0) stickyClass = "sticky-col col-rank"; 
                if(index === 1) stickyClass = "sticky-col col-name"; 
                if(index === 2) stickyClass = "sticky-col col-score";
                
                let formattedHeader = h ? h.replace(" (", "<br><span class='small fw-normal text-white-50'>(") + "</span>" : "";
                
                if(stats[index]) {
                    let badgeColor = parseInt(stats[index]) > 50 ? 'bg-success' : 'bg-secondary';
                    formattedHeader += `<br><span class="badge ${badgeColor} mt-1" style="font-size:0.7em">${stats[index]}</span>`;
                }
                html += `<th class="${stickyClass}">${formattedHeader}</th>`;
            });
            html += `</tr>`;

            // ROW 2: ANSWER KEY (Moved inside THEAD so it freezes too!)
            html += `<tr class="key-row">`;
            keyRow.forEach((cell, index) => {
                let stickyClass = "";
                if(index === 0) stickyClass = "sticky-col col-rank key-row";
                if(index === 1) stickyClass = "sticky-col col-name key-row";
                if(index === 2) stickyClass = "sticky-col col-score key-row";
                html += `<td class="${stickyClass}">${cell ? cell : "-"}</td>`;
            });
            html += `</tr>`;
            
            html += `</thead><tbody>`; // Close Head, Open Body

            // --- BUILD PLAYER ROWS ---
            players.forEach((row, rank) => {
                if(!row[0]) return; 

                html += `<tr onclick="highlightRow(this)" class="player-row">`;
                row.forEach((cell, index) => {
                    let cssClass = "";
                    let content = cell ? cell : "";

                    if(index === 0) cssClass = "sticky-col col-rank";
                    if(index === 1) cssClass = "sticky-col col-name";
                    if(index === 2) cssClass = "sticky-col col-score";

                    if (index >= 3) { // Note: Index 3 is where answers start now
                        const correctAns = keyRow[index];
                        if (correctAns && correctAns.trim() !== "") {
                            if (content === correctAns) {
                                cssClass += " correct-cell"; 
                                content += ` <i class="fas fa-check small text-success"></i>`;
                            } else {
                                cssClass += " incorrect-cell"; 
                            }
                        }
                    }
                    html += `<td class="${cssClass}">${content}</td>`;
                });
                html += `</tr>`;
            });

            html += `</tbody>`;
            table.innerHTML = html;
            document.getElementById("loading").style.display = "none";
        }

        // Search & Highlight Logic
        function filterTable() {
            const input = document.getElementById("searchInput");
            const filter = input.value.toUpperCase();
            const tr = document.getElementById("prop-table").getElementsByTagName("tr");
            for (let i = 2; i < tr.length; i++) { // Skip first 2 rows (Head/Key)
                let td = tr[i].querySelector(".col-name");
                if (td) {
                    let txtValue = td.textContent || td.innerText;
                    tr[i].style.display = (txtValue.toUpperCase().indexOf(filter) > -1) ? "" : "none";
                }
            }
        }

        function highlightRow(row) {
            document.querySelectorAll(".player-row").forEach(r => r.classList.remove("table-warning"));
            row.classList.add("table-warning");
        }

        window.onload = loadData;
    </script>
</body>
</html>

